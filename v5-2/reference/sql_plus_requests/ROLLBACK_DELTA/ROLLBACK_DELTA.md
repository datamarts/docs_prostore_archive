---
layout: default
title: ROLLBACK DELTA
nav_order: 38
parent: Запросы SQL+
grand_parent: Справочная информация
has_children: false
has_toc: false
---

# ROLLBACK DELTA

Запрос позволяет откатить горячую (открытую) [дельту](../../../overview/main_concepts/delta/delta.md) — отменить все 
ее завершенные [операции записи](../../../overview/main_concepts/write_operation/write_operation.md) 
([загрузки](../../../working_with_system/data_upload/data_upload.md) и 
[обновления данных](../../../working_with_system/data_update/data_update.md)), а также 
незавершенные операции [загрузки данных](../../../working_with_system/data_upload/data_upload.md). 
Перед выполнением запроса необходимо определить логическую базу данных,
[используемую по умолчанию](../../../working_with_system/other_features/default_db_set-up/default_db_set-up.md),
если она еще не определена.

После запуска запроса невозможно закрыть дельту, даже если система не смогла откатить дельту и вернула исключение.
{: .warning-wrapper}

Невозможен откат незавершенных операций [обновления данных](../../../working_with_system/data_update/data_update.md) 
горячей дельты, а также откат любых операций закрытой дельты.
{: .note-wrapper}

Система не гарантирует остановку и отмену всех операций за один вызов. Если в ответ на запрос вернулась ошибка 
`Can't rollback delta by datamart <db_name>`, это означает, что не все операции записи горячей дельты были отменены. 
В этом случае необходимо повторить запрос.

Откат горячей дельты выполняется в следующем порядке:
1. Останавливаются выполняемые операции [загрузки данных](../../../working_with_system/data_upload/data_upload.md).
   <br>Операции останавливаются асинхронно, и система периодически проверяет, остались ли неостановленные операции. 
   Проверка запускается раз в интервал, равный значению 
   параметра `DELTA_ROLLBACK_STATUS_CALLS_MS` в [конфигурации системы](../../../maintenance/configuration/system/system.md).
2. Отменяются следующие операции горячей дельты (и связанные с ними изменения): все операции, завершенные успешно 
   или с ошибкой, а также остановленные операции загрузки данных. Незавершенные операции 
   [обновления данных](../../../working_with_system/data_update/data_update.md) не отменяются.
3. Горячая дельта удаляется из [сервисной базы данных](../../../overview/main_concepts/service_db/service_db.md),
   и зарезервированный ранее номер горячей дельты освобождается.

В ответе возвращается:
*   объект ResultSet c одной записью, содержащей номер последней закрытой дельты, при успешном выполнении 
    запроса;
*   исключение при неуспешном выполнении запроса.

Если операция обновления данных зависла, дельту невозможно закрыть или откатить. В этом случае нужно повторить запрос, 
запустивший проблемную операцию. Действие перезапустит обработку операции, и после ее завершения можно будет 
откатить или [закрыть дельту](../COMMIT_DELTA/COMMIT_DELTA.md).
{: .tip-wrapper}

После отката горячей дельты становятся доступны действия по созданию, удалению и изменению таблиц и представлений.
{: .note-wrapper}

## Синтаксис {#syntax}

```sql
ROLLBACK DELTA
```