<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Сборка и развёртывание - Документация Prostore</title> <link rel="shortcut icon" href="/docs_prostore_archive/v5-4/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/docs_prostore_archive/v5-4/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/docs_prostore_archive/v5-4/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/docs_prostore_archive/v5-4/assets/js/vendor/lunr.stemmer.support.min.js"></script> <script type="text/javascript" src="/docs_prostore_archive/v5-4/assets/js/vendor/lunr.ru.min.js"></script> <script type="text/javascript" src="/docs_prostore_archive/v5-4/assets/js/vendor/lunr.multi.min.js"></script> <script type="text/javascript" src="/docs_prostore_archive/v5-4/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Сборка и развёртывание | Документация Prostore</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Сборка и развёртывание" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A Jekyll theme for documentation" /> <meta property="og:description" content="A Jekyll theme for documentation" /> <link rel="canonical" href="https://datamarts.github.io/docs_prostore_archive/v5-4/getting_started/getting_started.html" /> <meta property="og:url" content="https://datamarts.github.io/docs_prostore_archive/v5-4/getting_started/getting_started.html" /> <meta property="og:site_name" content="Документация Prostore" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Сборка и развёртывание" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A Jekyll theme for documentation","headline":"Сборка и развёртывание","url":"https://datamarts.github.io/docs_prostore_archive/v5-4/getting_started/getting_started.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/" class="site-title lh-tight"> Документация Prostore </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/introduction/introduction.html" class="nav-list-link">Введение</a><ul class="nav-list "><li class="nav-list-item "><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/introduction/terms/terms.html" class="nav-list-link">Термины и определения</a></li><li class="nav-list-item "><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/introduction/supported_DBMS/supported_DBMS.html" class="nav-list-link">Поддерживаемые СУБД хранилища</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/overview.html" class="nav-list-link">Обзор понятий, компонентов и связей</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/main_concepts/main_concepts.html" class="nav-list-link">Основные понятия</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/main_concepts/logical_schema/logical_schema.html" class="nav-list-link">Логическая схема данных</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/main_concepts/logical_db/logical_db.html" class="nav-list-link">Логическая база данных</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/main_concepts/environment/environment.html" class="nav-list-link">Окружение</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/main_concepts/logical_table/logical_table.html" class="nav-list-link">Логическая таблица</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/main_concepts/logical_view/logical_view.html" class="nav-list-link">Логическое представление</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/main_concepts/materialized_view/materialized_view.html" class="nav-list-link">Материализованное представление</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/main_concepts/external_table/external_table.html" class="nav-list-link">Внешняя таблица</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/main_concepts/data_storage/data_storage.html" class="nav-list-link">Хранилище данных</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/main_concepts/service_db/service_db.html" class="nav-list-link">Сервисная база данных</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/main_concepts/physical_schema/physical_schema.html" class="nav-list-link">Физическая схема данных</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/main_concepts/physical_table/physical_table.html" class="nav-list-link">Физическая таблица</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/main_concepts/write_operation/write_operation.html" class="nav-list-link">Операция записи</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/main_concepts/delta/delta.html" class="nav-list-link">Дельта</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/main_concepts/changelog/changelog.html" class="nav-list-link">Журнал</a> </li></ul></li><li class="nav-list-item "><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/components/components.html" class="nav-list-link">Компоненты системы</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/interactions/interactions.html" class="nav-list-link">Связи с другими системами и компонентами</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/interactions/ddl_processing/ddl_processing.html" class="nav-list-link">Порядок обработки запросов на обновление логической схемы</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/interactions/upload_processing/upload_processing.html" class="nav-list-link">Порядок обработки запросов на загрузку данных</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/interactions/llw_processing/llw_processing.html" class="nav-list-link">Порядок обработки запросов на обновление данных</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/interactions/download_processing/download_processing.html" class="nav-list-link">Порядок обработки запросов на выгрузку данных</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/interactions/llr_processing/llr_processing.html" class="nav-list-link">Порядок обработки запросов на чтение данных</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/overview/interactions/restart_processing/restart_processing.html" class="nav-list-link">Порядок перезапуска системы</a> </li></ul></li></ul></li><li class="nav-list-item active"><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/getting_started/getting_started.html" class="nav-list-link active">Сборка и развёртывание</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/maintenance/maintenance.html" class="nav-list-link">Эксплуатация</a><ul class="nav-list "><li class="nav-list-item "><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/maintenance/system_requirements/system_requirements.html" class="nav-list-link">Минимальные системные требования</a></li><li class="nav-list-item "><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/maintenance/deployment_diagrams/deployment_diagrams.html" class="nav-list-link">Схемы развертывания</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/maintenance/configuration/configuration.html" class="nav-list-link">Конфигурация</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/maintenance/configuration/system/system.html" class="nav-list-link">Конфигурация системы</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/maintenance/configuration/connectors/connectors.html" class="nav-list-link">Конфигурация коннекторов</a> </li></ul></li><li class="nav-list-item "><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/maintenance/json_logs_configuration/json_logs_configuration.html" class="nav-list-link">Настройка JSON-логов</a></li><li class="nav-list-item "><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/maintenance/time_zones/time_zones.html" class="nav-list-link">Часовые пояса системы и компонентов</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/working_with_system.html" class="nav-list-link">Работа с системой</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/connection/connection.html" class="nav-list-link">Подключение</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/connection/connection_via_sql_client/connection_via_sql_client.html" class="nav-list-link">Подключение с помощью SQL-клиента</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/connection/connection_via_code/connection_via_code.html" class="nav-list-link">Программное подключение</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/logical_schema_update/logical_schema_update.html" class="nav-list-link">Управление схемой данных</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/logical_schema_update/create_db/create_db.html" class="nav-list-link">Создание логической базы данных</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/logical_schema_update/drop_db/drop_db.html" class="nav-list-link">Удаление логической базы данных</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/logical_schema_update/create_table/create_table.html" class="nav-list-link">Создание логической таблицы</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/logical_schema_update/drop_table/drop_table.html" class="nav-list-link">Удаление логической таблицы</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/logical_schema_update/create_view/create_view.html" class="nav-list-link">Создание логического представления</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/logical_schema_update/alter_view/alter_view.html" class="nav-list-link">Изменение логического представления</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/logical_schema_update/drop_view/drop_view.html" class="nav-list-link">Удаление логического представления</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/logical_schema_update/create_materialized_view/create_materialized_view.html" class="nav-list-link">Создание материализованного представления</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/logical_schema_update/drop_materialized_view/drop_materialized_view.html" class="nav-list-link">Удаление материализованного представления</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/logical_schema_update/create_upload_table/create_upload_table.html" class="nav-list-link">Создание внешней таблицы загрузки</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/logical_schema_update/drop_upload_table/drop_upload_table.html" class="nav-list-link">Удаление внешней таблицы загрузки</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/logical_schema_update/create_download_table/create_download_table.html" class="nav-list-link">Создание внешней таблицы выгрузки</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/logical_schema_update/drop_download_table/drop_download_table.html" class="nav-list-link">Удаление внешней таблицы выгрузки</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/logical_schema_update/entity_presence_check/entity_presence_check.html" class="nav-list-link">Проверка наличия логической сущности</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/logical_schema_update/request_from_schema/request_from_schema.html" class="nav-list-link">Запрос метаданных логической схемы</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/data_upload/data_upload.html" class="nav-list-link">Загрузка данных</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/data_upload/data_versioning/data_versioning.html" class="nav-list-link">Версионирование данных</a> </li></ul></li><li class="nav-list-item "><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/data_update/data_update.html" class="nav-list-link">Обновление данных</a></li><li class="nav-list-item "><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/data_download/data_download.html" class="nav-list-link">Выгрузка данных</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/data_reading/data_reading.html" class="nav-list-link">Запрос данных</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/data_reading/routing/routing.html" class="nav-list-link">Маршрутизация запросов к данным</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/other_features/other_features.html" class="nav-list-link">Другие действия</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/other_features/default_db_set-up/default_db_set-up.html" class="nav-list-link">Определение логической БД по умолчанию</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/other_features/troubleshooting/troubleshooting.html" class="nav-list-link">Разбор ошибок загрузки и обновления данных</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/other_features/datasource_check/datasource_check.html" class="nav-list-link">Проверка месторасположения логической сущности</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/working_with_system/other_features/query_estimation/query_estimation.html" class="nav-list-link">Получение информации о SELECT-запросе</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/reference.html" class="nav-list-link">Справочная информация</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/sql_plus_requests.html" class="nav-list-link">Запросы SQL+</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/ALLOW_CHANGES/ALLOW_CHANGES.html" class="nav-list-link">ALLOW_CHANGES</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/ALTER_VIEW/ALTER_VIEW.html" class="nav-list-link">ALTER VIEW</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/BEGIN_DELTA/BEGIN_DELTA.html" class="nav-list-link">BEGIN DELTA</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/CHECK_DATA/CHECK_DATA.html" class="nav-list-link">CHECK_DATA</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/CHECK_DATABASE/CHECK_DATABASE.html" class="nav-list-link">CHECK_DATABASE</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/CHECK_MATERIALIZED_VIEW/CHECK_MATERIALIZED_VIEW.html" class="nav-list-link">CHECK_MATERIALIZED_VIEW</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/CHECK_SUM/CHECK_SUM.html" class="nav-list-link">CHECK_SUM</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/CHECK_SUM_SNAPSHOT/CHECK_SUM_SNAPSHOT.html" class="nav-list-link">CHECK_SUM_SNAPSHOT</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/CHECK_TABLE/CHECK_TABLE.html" class="nav-list-link">CHECK_TABLE</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/CHECK_VERSIONS/CHECK_VERSIONS.html" class="nav-list-link">CHECK_VERSIONS</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/COMMIT_DELTA/COMMIT_DELTA.html" class="nav-list-link">COMMIT DELTA</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/CONFIG_SHOW/CONFIG_SHOW.html" class="nav-list-link">CONFIG_SHOW</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/CONFIG_STORAGE_ADD/CONFIG_STORAGE_ADD.html" class="nav-list-link">CONFIG_STORAGE_ADD</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/CREATE_DATABASE/CREATE_DATABASE.html" class="nav-list-link">CREATE DATABASE</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/CREATE_DOWNLOAD_EXTERNAL_TABLE/CREATE_DOWNLOAD_EXTERNAL_TABLE.html" class="nav-list-link">CREATE DOWNLOAD EXTERNAL TABLE</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/CREATE_MATERIALIZED_VIEW/CREATE_MATERIALIZED_VIEW.html" class="nav-list-link">CREATE MATERIALIZED VIEW</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/CREATE_TABLE/CREATE_TABLE.html" class="nav-list-link">CREATE TABLE</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/CREATE_UPLOAD_EXTERNAL_TABLE/CREATE_UPLOAD_EXTERNAL_TABLE.html" class="nav-list-link">CREATE UPLOAD EXTERNAL TABLE</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/CREATE_VIEW/CREATE_VIEW.html" class="nav-list-link">CREATE VIEW</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/DELETE/DELETE.html" class="nav-list-link">DELETE</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/DENY_CHANGES/DENY_CHANGES.html" class="nav-list-link">DENY_CHANGES</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/DROP_DATABASE/DROP_DATABASE.html" class="nav-list-link">DROP DATABASE</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/DROP_DOWNLOAD_EXTERNAL_TABLE/DROP_DOWNLOAD_EXTERNAL_TABLE.html" class="nav-list-link">DROP DOWNLOAD EXTERNAL TABLE</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/DROP_MATERIALIZED_VIEW/DROP_MATERIALIZED_VIEW.html" class="nav-list-link">DROP MATERIALIZED VIEW</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/DROP_TABLE/DROP_TABLE.html" class="nav-list-link">DROP TABLE</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/DROP_UPLOAD_EXTERNAL_TABLE/DROP_UPLOAD_EXTERNAL_TABLE.html" class="nav-list-link">DROP UPLOAD EXTERNAL TABLE</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/DROP_VIEW/DROP_VIEW.html" class="nav-list-link">DROP VIEW</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/GET_CHANGES/GET_CHANGES.html" class="nav-list-link">GET_CHANGES</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/GET_DELTA_BY_DATETIME/GET_DELTA_BY_DATETIME.html" class="nav-list-link">GET_DELTA_BY_DATETIME</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/GET_DELTA_BY_NUM/GET_DELTA_BY_NUM.html" class="nav-list-link">GET_DELTA_BY_NUM</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/GET_DELTA_HOT/GET_DELTA_HOT.html" class="nav-list-link">GET_DELTA_HOT</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/GET_DELTA_OK/GET_DELTA_OK.html" class="nav-list-link">GET_DELTA_OK</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/GET_ENTITY_DDL/GET_ENTITY_DDL.html" class="nav-list-link">GET_ENTITY_DDL</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/GET_WRITE_OPERATIONS/GET_WRITE_OPERATIONS.html" class="nav-list-link">GET_WRITE_OPERATIONS</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/INSERT_INTO_download_external_table/INSERT_INTO_download_external_table.html" class="nav-list-link">INSERT INTO download_external_table</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/INSERT_INTO_logical_table/INSERT_INTO_logical_table.html" class="nav-list-link">INSERT INTO logical_table</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/INSERT_SELECT/INSERT_SELECT.html" class="nav-list-link">INSERT SELECT</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/INSERT_VALUES/INSERT_VALUES.html" class="nav-list-link">INSERT VALUES</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/RESUME_WRITE_OPERATION/RESUME_WRITE_OPERATION.html" class="nav-list-link">RESUME_WRITE_OPERATION</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/ROLLBACK_CRASHED_WRITE_OPERATIONS/ROLLBACK_CRASHED_WRITE_OPERATIONS.html" class="nav-list-link">ROLLBACK CRASHED_WRITE_OPERATIONS</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/ROLLBACK_DELTA/ROLLBACK_DELTA.html" class="nav-list-link">ROLLBACK DELTA</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/SELECT/SELECT.html" class="nav-list-link">SELECT</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/SELECT_FROM_INFORMATION_SCHEMA/SELECT_FROM_INFORMATION_SCHEMA.html" class="nav-list-link">SELECT FROM INFORMATION_SCHEMA</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/TRUNCATE_HISTORY/TRUNCATE_HISTORY.html" class="nav-list-link">TRUNCATE HISTORY</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/UPSERT_VALUES/UPSERT_VALUES.html" class="nav-list-link">UPSERT VALUES</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/USE/USE.html" class="nav-list-link">USE</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_plus_requests/USE_INFORMATION_SCHEMA/USE_INFORMATION_SCHEMA.html" class="nav-list-link">USE INFORMATION_SCHEMA</a> </li></ul></li><li class="nav-list-item "><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/reserved_words/reserved_words.html" class="nav-list-link">Зарезервированные слова</a></li><li class="nav-list-item "><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/sql_support/sql_support.html" class="nav-list-link">Поддержка SQL</a></li><li class="nav-list-item "><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/path_to_kafka_topic/path_to_kafka_topic.html" class="nav-list-link">Формат пути к внешнему приемнику данных</a></li><li class="nav-list-item "><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/upload_format/upload_format.html" class="nav-list-link">Формат загрузки данных</a></li><li class="nav-list-item "><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/download_format/download_format.html" class="nav-list-link">Формат выгрузки данных</a></li><li class="nav-list-item "><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/timestamp_formats/timestamp_formats.html" class="nav-list-link">Форматы даты и времени в запросах</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/supported_data_types/supported_data_types.html" class="nav-list-link">Поддерживаемые типы данных</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/supported_data_types/logical_data_types/logical_data_types.html" class="nav-list-link">Логические типы данных</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/supported_data_types/upload_data_types/upload_data_types.html" class="nav-list-link">Загружаемые типы данных Avro</a> </li><li class="nav-list-item "> <a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/supported_data_types/download_data_types/download_data_types.html" class="nav-list-link">Выгружаемые типы данных Avro</a> </li></ul></li><li class="nav-list-item "><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/reference/system_views/system_views.html" class="nav-list-link">Системные представления (INFORMATION_SCHEMA)</a></li></ul></li><li class="nav-list-item"><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/restrictions/restrictions.html" class="nav-list-link">Ограничения системы</a></li><li class="nav-list-item"><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/resources/resources.html" class="nav-list-link">Ресурсы</a></li><li class="nav-list-item"><a href="https://datamarts.github.io/docs_prostore_archive/v5-4/revision_history/revision_history.html" class="nav-list-link">История изменений</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Документация Prostore" aria-label="Search Документация Prostore" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h1 id="build_and_deploy" class="no_toc"> <a href="#build_and_deploy" class="anchor-heading" aria-labelledby="build_and_deploy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Сборка и развёртывание </h1> <details> <summary class="text-delta"> Содержание раздела </summary> <ol id="markdown-toc"> <li><a href="#preinstalled_software" id="markdown-toc-preinstalled_software">Предустановленные программные средства</a></li> <li><a href="#prostore_build" id="markdown-toc-prostore_build">Сборка Prostore</a></li> <li><a href="#postgres_setup" id="markdown-toc-postgres_setup">Настройка СУБД Postgres</a></li> <li><a href="#kafka_postgres_connector_build_deploy" id="markdown-toc-kafka_postgres_connector_build_deploy">Сборка и установка коннектора Kafka-Postgres</a></li> <li><a href="#zookeeper_kafka_execution" id="markdown-toc-zookeeper_kafka_execution">Запуск сервисов Apache Zookeeper и Apache Kafka</a></li> <li><a href="#kafka_postgres_execution" id="markdown-toc-kafka_postgres_execution">Запуск коннектора Kafka-Postgres</a></li> <li><a href="#dtm_status_monitor_execution" id="markdown-toc-dtm_status_monitor_execution">Запуск службы dtm-status-monitor</a></li> <li><a href="#prostore_execution" id="markdown-toc-prostore_execution">Запуск Prostore</a></li> <li><a href="#sql_client_connection" id="markdown-toc-sql_client_connection">Подключение к Prostore с помощью SQL-клиента</a></li> <li><a href="#demo_scenario" id="markdown-toc-demo_scenario">Демонстрационный сценарий</a> <ol> <li><a href="#logical_entities_creation" id="markdown-toc-logical_entities_creation">Создание необходимых логических сущностей</a></li> <li><a href="#upload_kafka_topic_creation" id="markdown-toc-upload_kafka_topic_creation">Создание топика Kafka для последующей загрузки данных</a></li> <li><a href="#avro_file_creation" id="markdown-toc-avro_file_creation">Создание бинарного avro-файла kafka_upload_sales.avro из avro-схемы и данных</a></li> <li><a href="#avro_file_upload" id="markdown-toc-avro_file_upload">Загрузка avro-файла kafka_upload_sales.avro</a></li> <li><a href="#data_upload" id="markdown-toc-data_upload">Загрузка данных</a></li> <li><a href="#data_upsert" id="markdown-toc-data_upsert">Вставка данных</a></li> <li><a href="#data_selection" id="markdown-toc-data_selection">Выборка данных</a></li> <li><a href="#kafka_topic_download" id="markdown-toc-kafka_topic_download">Выгрузка в топик Kafka</a></li> <li><a href="#logical_entities_drop" id="markdown-toc-logical_entities_drop">Удаление логических сущностей</a></li> </ol> </li> </ol> </details> <p>В этом разделе описаны шаги по развёртыванию среды в конфигурации, предполагающей единственное хранилище — СУБД PostgreSQL. Дополнительная информация приведена в разделе <a href="/docs_prostore_archive/v5-4/maintenance/deployment_diagrams/deployment_diagrams.html">Схемы развёртывания</a>.</p> <h2 id="preinstalled_software"> <a href="#preinstalled_software" class="anchor-heading" aria-labelledby="preinstalled_software"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Предустановленные программные средства </h2> <ul> <li>OC Centos 7;</li> <li>yum-utils;</li> <li>curl;</li> <li>git;</li> <li>wget;</li> <li>OpenJDK 8;</li> <li>Apache Maven 3.6.3;</li> <li>СУБД PostgreSQL 13;</li> <li>Apache Zookeeper;</li> <li>Apache Kafka (например, в каталоге /opt/kafka);</li> <li>SQL-клиент, например DBeaver;</li> <li>docker;</li> <li>Браузер топиков Kafka с возможностью загрузки бинарных данных, например kafkacat.</li> </ul> <h2 id="prostore_build"> <a href="#prostore_build" class="anchor-heading" aria-labelledby="prostore_build"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Сборка Prostore </h2> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># клонирование репозитория Prostore</span>
git clone https://github.com/datamarts/prostore ~/prostore
<span class="c"># запуск сборки Prostore средствами Apache Maven</span>
<span class="nb">cd</span> ~/prostore
mvn clean <span class="nb">install</span> <span class="nt">-DskipTests</span><span class="o">=</span><span class="nb">true</span>
<span class="c"># создание символической ссылки на файл конфигурации</span>
<span class="nb">sudo ln</span> <span class="nt">-s</span> ~/prostore/dtm-query-execution-core/config/application.yml ~/prostore/dtm-query-execution-core/target/application.yml
<span class="c"># приведение конфигурационного файла к виду, показанному ниже</span>
<span class="nb">sudo </span>nano ~/prostore/dtm-query-execution-core/config/application.yml
</code></pre></div></div> <details> <summary class="text-delta"> конфигурационный файл Prostore `application.yml` </summary> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#</span>
<span class="c1"># Copyright © 2021 ProStore</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the "License");</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an "AS IS" BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="c1">#</span>

<span class="na">logging</span><span class="pi">:</span>
  <span class="na">level</span><span class="pi">:</span>
    <span class="s">ru.datamart.prostore.query.execution</span><span class="pi">:</span> <span class="s">${DTM_LOGGING_LEVEL:TRACE}</span>

<span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="s">${DTM_METRICS_PORT:8080}</span>

<span class="na">management</span><span class="pi">:</span>
  <span class="na">endpoints</span><span class="pi">:</span>
    <span class="na">enabled-by-default</span><span class="pi">:</span> <span class="s">${DTM_METRICS_ENABLED:true}</span>
    <span class="na">web</span><span class="pi">:</span>
      <span class="na">exposure</span><span class="pi">:</span>
        <span class="na">include</span><span class="pi">:</span> <span class="s">${DTM_METRICS_SCOPE:info, health, requests}</span>

<span class="na">core</span><span class="pi">:</span>
  <span class="na">plugins</span><span class="pi">:</span>
    <span class="na">active</span><span class="pi">:</span> <span class="s">${CORE_PLUGINS_ACTIVE:ADP}</span>

  <span class="na">http</span><span class="pi">:</span>
    <span class="na">port</span><span class="pi">:</span> <span class="s">${DTM_CORE_HTTP_PORT:9090}</span>
    <span class="na">tcpNoDelay</span><span class="pi">:</span> <span class="s">${DTM_CORE_HTTP_TCP_NO_DELAY:true}</span>
    <span class="na">tcpFastOpen</span><span class="pi">:</span> <span class="s">${DTM_CORE_HTTP_TCP_FAST_OPEN:true}</span>
    <span class="na">tcpQuickAck</span><span class="pi">:</span> <span class="s">${DTM_CORE_HTTP_TCP_QUICK_ACK:true}</span>

  <span class="na">env</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">${DTM_NAME:test}</span>

  <span class="na">restoration</span><span class="pi">:</span>
    <span class="na">autoRestoreState</span><span class="pi">:</span> <span class="s">${AUTO_RESTORE_STATE:true}</span>

  <span class="na">matviewsync</span><span class="pi">:</span>
    <span class="na">periodMs</span><span class="pi">:</span> <span class="s">${MATERIALIZED_VIEWS_SYNC_PERIOD_MS:5000}</span>
    <span class="na">retryCount</span><span class="pi">:</span> <span class="s">${MATERIALIZED_VIEWS_RETRY_COUNT:10}</span>
    <span class="na">maxConcurrent</span><span class="pi">:</span> <span class="s">${MATERIALIZED_VIEWS_CONCURRENT:2}</span>

  <span class="na">metrics</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="s">${DTM_CORE_METRICS_ENABLED:true}</span>

  <span class="na">datasource</span><span class="pi">:</span>
    <span class="na">edml</span><span class="pi">:</span>
      <span class="na">defaultChunkSize</span><span class="pi">:</span> <span class="s">${EDML_DEFAULT_CHUNK_SIZE:1000}</span>
      <span class="na">pluginStatusCheckPeriodMs</span><span class="pi">:</span> <span class="s">${EDML_STATUS_CHECK_PERIOD_MS:1000}</span>
      <span class="na">firstOffsetTimeoutMs</span><span class="pi">:</span> <span class="s">${EDML_FIRST_OFFSET_TIMEOUT_MS:15000}</span>
      <span class="na">changeOffsetTimeoutMs</span><span class="pi">:</span> <span class="s">${EDML_CHANGE_OFFSET_TIMEOUT_MS:10000}</span>
    <span class="na">zookeeper</span><span class="pi">:</span>
      <span class="na">connection-string</span><span class="pi">:</span> <span class="s">${ZOOKEEPER_DS_ADDRESS:localhost}</span>
      <span class="na">connection-timeout-ms</span><span class="pi">:</span> <span class="s">${ZOOKEEPER_DS_CONNECTION_TIMEOUT_MS:30000}</span>
      <span class="na">session-timeout-ms</span><span class="pi">:</span> <span class="s">${ZOOKEEPER_DS_SESSION_TIMEOUT_MS:86400000}</span>
      <span class="na">chroot</span><span class="pi">:</span> <span class="s">${ZOOKEEPER_DS_CHROOT:/adtm}</span>

  <span class="na">kafka</span><span class="pi">:</span>
    <span class="na">producer</span><span class="pi">:</span>
      <span class="na">property</span><span class="pi">:</span>
        <span class="s">key.serializer</span><span class="pi">:</span> <span class="s">org.apache.kafka.common.serialization.StringSerializer</span>
        <span class="s">value.serializer</span><span class="pi">:</span> <span class="s">org.apache.kafka.common.serialization.StringSerializer</span>
    <span class="na">cluster</span><span class="pi">:</span>
      <span class="na">zookeeper</span><span class="pi">:</span>
        <span class="na">connection-string</span><span class="pi">:</span> <span class="s">${ZOOKEEPER_KAFKA_ADDRESS:localhost}</span>
        <span class="na">connection-timeout-ms</span><span class="pi">:</span> <span class="s">${ZOOKEEPER_KAFKA_CONNECTION_TIMEOUT_MS:30000}</span>
        <span class="na">session-timeout-ms</span><span class="pi">:</span> <span class="s">${ZOOKEEPER_KAFKA_SESSION_TIMEOUT_MS:86400000}</span>
        <span class="na">chroot</span><span class="pi">:</span> <span class="s">${ZOOKEEPER_KAFKA_CHROOT:}</span>
    <span class="na">admin</span><span class="pi">:</span>
      <span class="na">inputStreamTimeoutMs</span><span class="pi">:</span> <span class="s">${KAFKA_INPUT_STREAM_TIMEOUT_MS:2000}</span>
    <span class="s">status.event.publish</span><span class="pi">:</span>
      <span class="na">enabled</span><span class="pi">:</span> <span class="s">${KAFKA_STATUS_EVENT_ENABLED:false}</span>
    <span class="na">statusMonitor</span><span class="pi">:</span>
      <span class="na">statusUrl</span><span class="pi">:</span> <span class="s">${STATUS_MONITOR_URL:http://localhost:9095/status}</span>
      <span class="na">versionUrl</span><span class="pi">:</span> <span class="s">${STATUS_MONITOR_VERSION_URL:http://localhost:9095/versions}</span>

  <span class="na">vertx</span><span class="pi">:</span>
    <span class="na">blocking-stacktrace-time</span><span class="pi">:</span> <span class="s">${DTM_VERTX_BLOCKING_STACKTRACE_TIME:1}</span>
    <span class="na">pool</span><span class="pi">:</span>
      <span class="na">worker-pool</span><span class="pi">:</span> <span class="s">${DTM_CORE_WORKER_POOL_SIZE:20}</span>
      <span class="na">event-loop-pool</span><span class="pi">:</span> <span class="s">${DTM_CORE_EVENT_LOOP_POOL_SIZE:20}</span>
      <span class="na">task-pool</span><span class="pi">:</span> <span class="s">${DTM_CORE_TASK_POOL_SIZE:20}</span>
      <span class="na">task-timeout</span><span class="pi">:</span> <span class="s">${DTM_CORE_TASK_TIMEOUT:86400000}</span>

  <span class="na">cache</span><span class="pi">:</span>
    <span class="na">initialCapacity</span><span class="pi">:</span> <span class="s">${CACHE_INITIAL_CAPACITY:100000}</span>
    <span class="na">maximumSize</span><span class="pi">:</span> <span class="s">${CACHE_MAXIMUM_SIZE:100000}</span>
    <span class="na">expireAfterAccessMinutes</span><span class="pi">:</span> <span class="s">${CACHE_EXPIRE_AFTER_ACCESS_MINUTES:99960}</span>

  <span class="na">delta</span><span class="pi">:</span>
    <span class="na">rollback-status-calls-ms</span><span class="pi">:</span> <span class="s">${DELTA_ROLLBACK_STATUS_CALLS_MS:2000}</span>

<span class="na">adp</span><span class="pi">:</span>
  <span class="na">datasource</span><span class="pi">:</span>
    <span class="na">user</span><span class="pi">:</span> <span class="s">${ADP_USERNAME:dtm}</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">${ADP_PASS:dtm}</span>
    <span class="na">host</span><span class="pi">:</span> <span class="s">${ADP_HOST:localhost}</span>
    <span class="na">port</span><span class="pi">:</span> <span class="s">${ADP_PORT:5432}</span>
    <span class="na">poolSize</span><span class="pi">:</span> <span class="s">${ADP_MAX_POOL_SIZE:3}</span>
    <span class="na">executorsCount</span><span class="pi">:</span> <span class="s">${ADP_EXECUTORS_COUNT:3}</span>
    <span class="na">fetchSize</span><span class="pi">:</span> <span class="s">${ADP_FETCH_SIZE:1000}</span>
    <span class="na">preparedStatementsCacheMaxSize</span><span class="pi">:</span> <span class="s">${ADP_PREPARED_CACHE_MAX_SIZE:256}</span>
    <span class="na">preparedStatementsCacheSqlLimit</span><span class="pi">:</span> <span class="s">${ADP_PREPARED_CACHE_SQL_LIMIT:2048}</span>
    <span class="na">preparedStatementsCache</span><span class="pi">:</span> <span class="s">${ADP_PREPARED_CACHE:true}</span>

  <span class="na">mppw</span><span class="pi">:</span>
    <span class="na">restStartLoadUrl</span><span class="pi">:</span> <span class="s">${ADP_REST_START_LOAD_URL:http://localhost:8096/newdata/start}</span>
    <span class="na">restStopLoadUrl</span><span class="pi">:</span> <span class="s">${ADP_REST_STOP_LOAD_URL:http://localhost:8096/newdata/stop}</span>
    <span class="na">restVersionUrl</span><span class="pi">:</span> <span class="s">${ADP_MPPW_CONNECTOR_VERSION_URL:http://localhost:8096/versions}</span>
    <span class="na">kafkaConsumerGroup</span><span class="pi">:</span> <span class="s">${ADP_KAFKA_CONSUMER_GROUP:adp-load}</span>

  <span class="na">mppr</span><span class="pi">:</span>
    <span class="na">restLoadUrl</span><span class="pi">:</span> <span class="s">${ADP_MPPR_QUERY_URL:http://localhost:8094/query}</span>
    <span class="na">restVersionUrl</span><span class="pi">:</span> <span class="s">${ADP_MPPR_CONNECTOR_VERSION_URL:http://localhost:8094/versions}</span>
</code></pre></div> </div> </details> <p>Далее конфигурационный файл <code class="language-sql highlighter-rouge"><span class="n">application</span><span class="p">.</span><span class="n">yml</span></code> обозначается термином “конфигурация Prostore”.</p> <h2 id="postgres_setup"> <a href="#postgres_setup" class="anchor-heading" aria-labelledby="postgres_setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Настройка СУБД Postgres </h2> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># создание в СУБД Postgres SUPERUSER-пользователя c именем и паролем,</span>
<span class="c"># указанными в конфигурации Prostore</span>
<span class="c"># (значения параметров (adp:datasource:user) и (adp:datasource:password) соответственно)</span>
<span class="nb">cd</span> /
<span class="nb">sudo</span> <span class="nt">-u</span> postgres psql <span class="nt">-c</span> <span class="s1">'CREATE ROLE dtm WITH LOGIN SUPERUSER'</span>
<span class="nb">sudo</span> <span class="nt">-u</span> postgres psql <span class="nt">-c</span> <span class="s2">"ALTER ROLE dtm WITH PASSWORD 'dtm'"</span>
<span class="c"># создание базы данных с именем test, указанным в конфигурации Prostore (env: name)</span>
<span class="nb">sudo</span> <span class="nt">-u</span> postgres psql <span class="nt">-c</span> <span class="s1">'CREATE DATABASE test'</span>
<span class="c"># перезапуск сервиса Postgresql</span>
<span class="nb">sudo </span>systemctl reload postgresql-13
</code></pre></div></div> <h2 id="kafka_postgres_connector_build_deploy"> <a href="#kafka_postgres_connector_build_deploy" class="anchor-heading" aria-labelledby="kafka_postgres_connector_build_deploy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Сборка и установка коннектора Kafka-Postgres </h2> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># клонирование репозитория kafka-postgres-connector</span>
git clone https://github.com/datamarts/kafka-postgres-connector ~/kafka-postgres-connector
<span class="c"># запуск сборки коннектора kafka-postgres средствами Apache Maven</span>
<span class="nb">cd</span> ~/kafka-postgres-connector
mvn clean <span class="nb">install</span> <span class="nt">-DskipTests</span><span class="o">=</span><span class="nb">true</span>
<span class="c"># приведение конфигурационных файлов kafka-postgres-writer и kafka-postgres-reader к виду,</span>
<span class="c"># показанному ниже, чтобы значения параметров совпадали со значениями соответствующих параметров конфигурации Prostore</span>
<span class="c"># datasource: postgres: database ~ env: name,</span>
<span class="c"># datasource: postgres: user     ~ adp: datasource: user,</span>
<span class="c"># datasource: postgres: password ~ adp: datasource: password,</span>
<span class="c"># datasource: postgres: hosts    ~ adp: datasource: host, adp: datasource: port</span>
<span class="nb">sudo </span>nano ~/kafka-postgres-connector/kafka-postgres-writer/src/main/resources/application.yml
<span class="nb">sudo </span>nano ~/kafka-postgres-connector/kafka-postgres-reader/src/main/resources/application.yml
<span class="c"># создание символических ссылок на файлы конфигурации</span>
<span class="nb">sudo ln</span> <span class="nt">-s</span> ~/kafka-postgres-connector/kafka-postrges-writer/src/main/resources/application.yml ~/kafka-postgres-connector/kafka-postrges-writer/target/application.yml
<span class="nb">sudo ln</span> <span class="nt">-s</span> ~/kafka-postgres-connector/kafka-postrges-reader/src/main/resources/application.yml ~/kafka-postgres-connector/kafka-postrges-reader/target/application.yml
</code></pre></div></div> <details> <summary class="text-delta"> конфигурационный файл kafka-postgres-writer `application.yml` </summary> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">logging</span><span class="pi">:</span>
  <span class="na">level</span><span class="pi">:</span>
    <span class="s">ru.datamart.kafka</span><span class="pi">:</span> <span class="s">${LOG_LEVEL:DEBUG}</span>
    <span class="s">org.apache.kafka</span><span class="pi">:</span> <span class="s">${KAFKA_LOG_LEVEL:INFO}</span>

<span class="na">http</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="s">${SERVER_PORT:8096}</span>

<span class="na">vertx</span><span class="pi">:</span>
  <span class="na">pools</span><span class="pi">:</span>
    <span class="na">eventLoopPoolSize</span><span class="pi">:</span> <span class="s">${VERTX_EVENT_LOOP_SIZE:12}</span>
    <span class="na">workersPoolSize</span><span class="pi">:</span> <span class="s">${VERTX_WORKERS_POOL_SIZE:32}</span>
  <span class="na">verticle</span><span class="pi">:</span>
    <span class="na">query</span><span class="pi">:</span>
      <span class="na">instances</span><span class="pi">:</span> <span class="s">${QUERY_VERTICLE_INSTANCES:12}</span>
    <span class="na">insert</span><span class="pi">:</span>
      <span class="na">poolSize</span><span class="pi">:</span> <span class="s">${INSERT_WORKER_POOL_SIZE:32}</span>
      <span class="na">insertPeriodMs</span><span class="pi">:</span> <span class="s">${INSERT_PERIOD_MS:1000}</span>
      <span class="na">batchSize</span><span class="pi">:</span> <span class="s">${INSERT_BATCH_SIZE:500}</span>
    <span class="na">consumer</span><span class="pi">:</span>
      <span class="na">poolSize</span><span class="pi">:</span> <span class="s">${KAFKA_CONSUMER_WORKER_POOL_SIZE:32}</span>
      <span class="na">maxFetchSize</span><span class="pi">:</span> <span class="s">${KAFKA_CONSUMER_MAX_FETCH_SIZE:10000}</span>
    <span class="na">commit</span><span class="pi">:</span>
      <span class="na">poolSize</span><span class="pi">:</span> <span class="s">${KAFKA_COMMIT_WORKER_POOL_SIZE:1}</span>
      <span class="na">commitPeriodMs</span><span class="pi">:</span> <span class="s">${KAFKA_COMMIT_WORKER_COMMIT_PERIOD_MS:1000}</span>

<span class="na">client</span><span class="pi">:</span>
  <span class="na">kafka</span><span class="pi">:</span>
    <span class="na">consumer</span><span class="pi">:</span>
      <span class="na">checkingTimeoutMs</span><span class="pi">:</span> <span class="s">${KAFKA_CHECKING_TIMEOUT_MS:10000}</span>
      <span class="na">responseTimeoutMs</span><span class="pi">:</span> <span class="s">${KAFKA_RESPONSE_TIMEOUT_MS:10000}</span>
      <span class="na">consumerSize</span><span class="pi">:</span> <span class="s">${KAFKA_CONSUMER_SIZE:10}</span>
      <span class="na">closeConsumersTimeout</span><span class="pi">:</span> <span class="s">${KAFKA_CLOSE_CONSUMER_TIMEOUT:15000}</span>
      <span class="na">property</span><span class="pi">:</span>
        <span class="s">bootstrap.servers</span><span class="pi">:</span> <span class="s">${KAFKA_BOOTSTRAP_SERVERS:kafka.host:9092}</span>
        <span class="s">group.id</span><span class="pi">:</span> <span class="s">${KAFKA_CONSUMER_GROUP_ID:postgres-query-execution}</span>
        <span class="s">auto.offset.reset</span><span class="pi">:</span> <span class="s">${KAFKA_AUTO_OFFSET_RESET:earliest}</span>
        <span class="s">enable.auto.commit</span><span class="pi">:</span> <span class="s">${KAFKA_AUTO_COMMIT:false}</span>
        <span class="s">auto.commit.interval.ms</span><span class="pi">:</span> <span class="s">${KAFKA_AUTO_INTERVAL_MS:1000}</span>

<span class="na">datasource</span><span class="pi">:</span>
  <span class="na">postgres</span><span class="pi">:</span>
    <span class="na">database</span><span class="pi">:</span> <span class="s">${POSTGRES_DB_NAME:test}</span>
    <span class="na">user</span><span class="pi">:</span> <span class="s">${POSTGRES_USERNAME:dtm}</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">${POSTGRES_PASS:dtm}</span>
    <span class="na">hosts</span><span class="pi">:</span> <span class="s">${POSTGRES_HOSTS:localhost:5432}</span>
    <span class="na">poolSize</span><span class="pi">:</span> <span class="s">${POSTGRES_POOLSIZE:10}</span>
    <span class="na">preparedStatementsCacheMaxSize</span><span class="pi">:</span> <span class="s">${POSTGRES_CACHE_MAX_SIZE:256}</span>
    <span class="na">preparedStatementsCacheSqlLimit</span><span class="pi">:</span> <span class="s">${POSTGRES_CACHE_SQL_LIMIT:2048}</span>
    <span class="na">preparedStatementsCache</span><span class="pi">:</span> <span class="s">${POSTGRES_CACHE:true}</span>
</code></pre></div> </div> </details> <details> <summary class="text-delta"> конфигурационный файл kafka-postgres-reader `application.yml` </summary> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">logging</span><span class="pi">:</span>
  <span class="na">level</span><span class="pi">:</span>
    <span class="s">ru.datamart.kafka</span><span class="pi">:</span> <span class="s">${LOG_LEVEL:DEBUG}</span>
    <span class="s">org.apache.kafka</span><span class="pi">:</span> <span class="s">${KAFKA_LOG_LEVEL:INFO}</span>

<span class="na">http</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="s">${SERVER_PORT:8094}</span>

<span class="na">vertx</span><span class="pi">:</span>
  <span class="na">pools</span><span class="pi">:</span>
    <span class="na">eventLoopPoolSize</span><span class="pi">:</span> <span class="s">${VERTX_EVENT_LOOP_SIZE:12}</span>
    <span class="na">workersPoolSize</span><span class="pi">:</span> <span class="s">${VERTX_WORKERS_POOL_SIZE:32}</span>
  <span class="na">verticle</span><span class="pi">:</span>
    <span class="na">query</span><span class="pi">:</span>
      <span class="na">instances</span><span class="pi">:</span> <span class="s">${QUERY_VERTICLE_INSTANCES:12}</span>

<span class="na">datasource</span><span class="pi">:</span>
  <span class="na">postgres</span><span class="pi">:</span>
    <span class="na">database</span><span class="pi">:</span> <span class="s">${POSTGRES_DB_NAME:test}</span>
    <span class="na">user</span><span class="pi">:</span> <span class="s">${POSTGRES_USERNAME:dtm}</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">${POSTGRES_PASS:dtm}</span>
    <span class="na">hosts</span><span class="pi">:</span> <span class="s">${POSTGRES_HOSTS:localhost:5432}</span>
    <span class="na">poolSize</span><span class="pi">:</span> <span class="s">${POSTGRES_POOLSIZE:10}</span>
    <span class="na">preparedStatementsCacheMaxSize</span><span class="pi">:</span> <span class="s">${POSTGRES_CACHE_MAX_SIZE:256}</span>
    <span class="na">preparedStatementsCacheSqlLimit</span><span class="pi">:</span> <span class="s">${POSTGRES_CACHE_SQL_LIMIT:2048}</span>
    <span class="na">preparedStatementsCache</span><span class="pi">:</span> <span class="s">${POSTGRES_CACHE:true}</span>
    <span class="na">fetchSize</span><span class="pi">:</span> <span class="s">${POSTGRES_FETCH_SIZE:1000}</span>

<span class="na">kafka</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="na">property</span><span class="pi">:</span>
      <span class="s">key.serializer</span><span class="pi">:</span> <span class="s">org.apache.kafka.common.serialization.ByteArraySerializer</span>
      <span class="s">value.serializer</span><span class="pi">:</span> <span class="s">org.apache.kafka.common.serialization.ByteArraySerializer</span>
</code></pre></div> </div> </details> <h2 id="zookeeper_kafka_execution"> <a href="#zookeeper_kafka_execution" class="anchor-heading" aria-labelledby="zookeeper_kafka_execution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Запуск сервисов Apache Zookeeper и Apache Kafka </h2> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># запуск одного экземпляра сервера ZooKeeper, если он еще не запущен</span>
<span class="nb">sudo </span>systemctl start zookeeper
<span class="c"># запуск сервера Kafka и проверка его состояния</span>
<span class="nb">sudo </span>systemctl start kafka
<span class="nb">sudo </span>systemctl status kafka
</code></pre></div></div> <h2 id="kafka_postgres_execution"> <a href="#kafka_postgres_execution" class="anchor-heading" aria-labelledby="kafka_postgres_execution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Запуск коннектора Kafka-Postgres </h2> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># запуск kafka-postgres-writer в отдельном окне терминала </span>
<span class="nb">cd</span> ~/kafka-postgres-connector/kafka-postgres-writer/target
java <span class="nt">-jar</span> kafka-postgres-writer-&lt;version&gt;.jar
<span class="c"># запуск kafka-postgres-reader в отдельном окне терминала</span>
<span class="nb">cd</span> ~/kafka-postgres-connector/kafka-postgres-reader/target
java <span class="nt">-jar</span> kafka-postgres-reader-&lt;version&gt;.jar
</code></pre></div></div> <h2 id="dtm_status_monitor_execution"> <a href="#dtm_status_monitor_execution" class="anchor-heading" aria-labelledby="dtm_status_monitor_execution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Запуск службы dtm-status-monitor </h2> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># создание символической ссылки на файл конфигурации dtm-status-monitor</span>
<span class="nb">sudo ln</span> <span class="nt">-s</span> ~/prostore/dtm-status-monitor/src/main/resources/application.yml ~/prostore/dtm-status-monitor/target/application.yml
<span class="c"># запуск dtm-status-monitor в отдельном окне терминала с указанием порта, заданного в конфигурации Prostore (core:kafka:statusMonitor)</span>
<span class="nb">cd</span> ~/prostore/dtm-status-monitor/target
java <span class="nt">-Dserver</span>.port<span class="o">=</span>9095 <span class="nt">-jar</span> dtm-status-monitor-&lt;version&gt;.jar
</code></pre></div></div> <p><strong><em>Примечание:</em></strong> Запуск службы dtm-status-monitor без указания порта <code class="language-sql highlighter-rouge"><span class="o">-</span><span class="n">Dserver</span><span class="p">.</span><span class="n">port</span></code> приведёт к конкуренции с сервисом Prostore за использование последним порта по умолчанию <code class="language-sql highlighter-rouge"><span class="mi">8080</span></code>.</p> <h2 id="prostore_execution"> <a href="#prostore_execution" class="anchor-heading" aria-labelledby="prostore_execution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Запуск Prostore </h2> <p>Запуск со значением по умолчанию (8080) для порта (server:port) в конфигурации Prostore:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># запуск файла dtm-query-execution-core-&lt;version&gt;.jar (например, dtm-query-execution-core-5.1.0.jar)</span>
<span class="nb">cd</span> ~/prostore/dtm-query-execution-core/target
java <span class="nt">-jar</span> dtm-query-execution-core-&lt;version&gt;.jar
</code></pre></div></div> <p>Запуск с иным заданным значением осуществляется путём изменения параметра (server:port) в конфигурации Prostore или задании переменной окружения <DTM_METRICS_PORT>.</DTM_METRICS_PORT></p> <h2 id="sql_client_connection"> <a href="#sql_client_connection" class="anchor-heading" aria-labelledby="sql_client_connection"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Подключение к Prostore с помощью SQL-клиента </h2> <p>Порядок подключения описан в разделе <a href="/docs_prostore_archive/v5-4/working_with_system/connection/connection_via_sql_client/connection_via_sql_client.html">Подключение с помощью SQL-клиента</a>.</p> <h2 id="demo_scenario"> <a href="#demo_scenario" class="anchor-heading" aria-labelledby="demo_scenario"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Демонстрационный сценарий </h2> <h3 id="logical_entities_creation"> <a href="#logical_entities_creation" class="anchor-heading" aria-labelledby="logical_entities_creation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Создание необходимых логических сущностей </h3> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- создание логической базы данных</span>
<span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">marketing</span><span class="p">;</span>

<span class="c1">-- выбор логической БД по умолчанию</span>
<span class="n">USE</span> <span class="n">marketing</span><span class="p">;</span>

<span class="c1">-- создание логической таблицы в БД marketing</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">sales</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">transaction_date</span> <span class="nb">TIMESTAMP</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">product_code</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">product_units</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">store_id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">description</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">DISTRIBUTED</span> <span class="k">BY</span> <span class="p">(</span><span class="n">id</span><span class="p">);</span>

<span class="c1">-- создание внешней таблицы загрузки</span>
<span class="k">CREATE</span> <span class="n">UPLOAD</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="n">sales_ext_upload</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">INT</span><span class="p">,</span>
  <span class="n">transaction_date</span> <span class="nb">TIMESTAMP</span><span class="p">,</span>
  <span class="n">product_code</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span>
  <span class="n">product_units</span> <span class="nb">INT</span><span class="p">,</span>
  <span class="n">store_id</span> <span class="nb">INT</span><span class="p">,</span>
  <span class="n">description</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">LOCATION</span>  <span class="s1">'kafka://localhost:2181/salesTopic'</span>
<span class="n">FORMAT</span> <span class="s1">'AVRO'</span>
<span class="n">MESSAGE_LIMIT</span> <span class="mi">1000</span><span class="p">;</span>

<span class="c1">-- создание логического представления stores_by_sold_products</span>
<span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">stores_by_sold_products</span> <span class="k">AS</span>
  <span class="k">SELECT</span> <span class="n">store_id</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">product_units</span><span class="p">)</span> <span class="k">AS</span> <span class="n">product_amount</span>
  <span class="k">FROM</span> <span class="n">sales</span>
  <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">store_id</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">product_amount</span> <span class="k">DESC</span>
  <span class="k">LIMIT</span> <span class="mi">30</span><span class="p">;</span>
  
<span class="c1">-- создание внешней таблицы выгрузки в топик Kafka "salesTopicOut"</span>
<span class="k">CREATE</span> <span class="n">DOWNLOAD</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="n">sales_ext_download</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">INT</span><span class="p">,</span>
  <span class="n">transaction_date</span> <span class="nb">TIMESTAMP</span><span class="p">,</span>
  <span class="n">product_code</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span>
  <span class="n">product_units</span> <span class="nb">INT</span><span class="p">,</span>
  <span class="n">store_id</span> <span class="nb">INT</span><span class="p">,</span>
  <span class="n">description</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">LOCATION</span>  <span class="s1">'kafka://localhost:2181/salesTopicOut'</span>
<span class="n">FORMAT</span> <span class="s1">'AVRO'</span>
<span class="n">CHUNK_SIZE</span> <span class="mi">1000</span><span class="p">;</span>
</code></pre></div></div> <h3 id="upload_kafka_topic_creation"> <a href="#upload_kafka_topic_creation" class="anchor-heading" aria-labelledby="upload_kafka_topic_creation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Создание топика Kafka для последующей загрузки данных </h3> <p>Создание топика Kafka “salesTopic” в терминале:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /opt/kafka/bin
bash kafka-topics.sh <span class="nt">--create</span> <span class="nt">--replication-factor</span> 1 <span class="nt">--partitions</span> 1 <span class="nt">--topic</span> salesTopic <span class="nt">--zookeeper</span> localhost:2181
</code></pre></div></div> <h3 id="avro_file_creation"> <a href="#avro_file_creation" class="anchor-heading" aria-labelledby="avro_file_creation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Создание бинарного avro-файла kafka_upload_sales.avro из avro-схемы и данных </h3> <details> <summary class="text-delta"> JSON-файл avro-схемы `kafka_upload_sales.avsc` </summary> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sales"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"namespace"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sales"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"record"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"id"</span><span class="p">,</span><span class="w">
	  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"transaction_date"</span><span class="p">,</span><span class="w">
	  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="p">,</span><span class="w">
	    </span><span class="nl">"logicalType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"timestamp-micros"</span><span class="w">
	  </span><span class="p">}</span><span class="w">	
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"product_code"</span><span class="p">,</span><span class="w">
	  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"product_units"</span><span class="p">,</span><span class="w">
	  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"store_id"</span><span class="p">,</span><span class="w">
	  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
	  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
	  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sys_op"</span><span class="p">,</span><span class="w">
	  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"int"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div> </div> </details> <details> <summary class="text-delta"> JSON-файл данных `kafka_upload_sales.json` </summary> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000111</span><span class="p">,</span><span class="w">
  </span><span class="nl">"transaction_date"</span><span class="p">:</span><span class="w"> </span><span class="mi">1614269474000000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"product_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ABC102101"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"product_units"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
  </span><span class="nl">"store_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000012345</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Покупка по акции 1+1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sys_op"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000112</span><span class="p">,</span><span class="w">
  </span><span class="nl">"transaction_date"</span><span class="p">:</span><span class="w"> </span><span class="mi">1614334214000000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"product_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ABC102001"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"product_units"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"store_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000000123</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Покупка без акций"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sys_op"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000020</span><span class="p">,</span><span class="w">
  </span><span class="nl">"transaction_date"</span><span class="p">:</span><span class="w"> </span><span class="mi">1614636614000000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"product_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ABC102010"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"product_units"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
  </span><span class="nl">"store_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000000123</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Покупка по акции 1+1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sys_op"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div> </div> </details> <details> <summary class="text-delta"> бинарный AVRO-файл `kafka_upload_sales.avro` </summary> <p><a href="/docs_prostore_archive/v5-4/getting_started/kafka_upload_sales.avro">Сохранить</a> бинарный файл</p> </details> <h3 id="avro_file_upload"> <a href="#avro_file_upload" class="anchor-heading" aria-labelledby="avro_file_upload"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Загрузка avro-файла kafka_upload_sales.avro </h3> <p>Загрузка avro-файла kafka_upload_sales.avro в топик Kafka “salesTopic” через терминал с помощью kafkacat:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#получение docker-образа kafkacat</span>
<span class="nb">sudo </span>docker pull edenhill/kcat:1.7.0
<span class="c">#запуск docker-образа kafkacat для загрузки в топик salesTopic</span>
<span class="c">#avro-файла /opt/kafka/sales/kafka_upload_sales.avro</span>
<span class="nb">sudo </span>docker run <span class="nt">-it</span> <span class="nt">--network</span> host <span class="se">\</span>
<span class="nt">--volume</span> /opt/kafka/sales/kafka_upload_sales.avro:/data/kafka_upload_sales.avro <span class="se">\</span>
edenhill/kcat:1.7.0 <span class="nt">-b</span> localhost:9092 <span class="nt">-t</span> salesTopic <span class="nt">-P</span> /data/kafka_upload_sales.avro
</code></pre></div></div> <h3 id="data_upload"> <a href="#data_upload" class="anchor-heading" aria-labelledby="data_upload"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Загрузка данных </h3> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- открытие новой (горячей) дельты</span>
<span class="k">BEGIN</span> <span class="n">DELTA</span><span class="p">;</span>
<span class="c1">-- запуск загрузки данных в логическую таблицу sales</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">sales</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">sales_ext_upload</span><span class="p">;</span>
<span class="c1">-- закрытие дельты (фиксация изменений)</span>
<span class="k">COMMIT</span> <span class="n">DELTA</span><span class="p">;</span>
</code></pre></div></div> <h3 id="data_upsert"> <a href="#data_upsert" class="anchor-heading" aria-labelledby="data_upsert"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Вставка данных </h3> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- открытие новой (горячей) дельты</span>
<span class="k">BEGIN</span> <span class="n">DELTA</span><span class="p">;</span>

<span class="c1">-- запуск вставки данных в логическую таблицу sales</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">sales</span>
<span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">transaction_date</span><span class="p">,</span> <span class="n">product_code</span><span class="p">,</span> <span class="n">product_units</span><span class="p">,</span> <span class="n">store_id</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
<span class="k">VALUES</span>
<span class="p">(</span><span class="mi">2000111</span><span class="p">,</span> <span class="s1">'2020-05-01 13:14:16'</span><span class="p">,</span> <span class="s1">'ABC202010'</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1000000123</span><span class="p">,</span> <span class="s1">'Покупка без акций'</span><span class="p">),</span>
<span class="p">(</span><span class="mi">2000112</span><span class="p">,</span> <span class="s1">'2020-05-02 16:13:17'</span><span class="p">,</span> <span class="s1">'ABC202011'</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">1000000456</span><span class="p">,</span> <span class="s1">'Покупка без акций'</span><span class="p">),</span>
<span class="p">(</span><span class="mi">2000113</span><span class="p">,</span> <span class="s1">'2020-05-03 21:15:17'</span><span class="p">,</span> <span class="s1">'ABC202012'</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1000000789</span><span class="p">,</span> <span class="s1">'Покупка без акций'</span><span class="p">),</span>
<span class="p">(</span><span class="mi">2000114</span><span class="p">,</span> <span class="s1">'2020-05-04 23:03:13'</span><span class="p">,</span> <span class="s1">'ABC202013'</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1000000123</span><span class="p">,</span> <span class="s1">'Покупка без акций'</span><span class="p">),</span>
<span class="p">(</span><span class="mi">2000115</span><span class="p">,</span> <span class="s1">'2020-05-05 14:10:21'</span><span class="p">,</span> <span class="s1">'ABC202014'</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">1000000623</span><span class="p">,</span> <span class="s1">'Покупка без акций'</span><span class="p">),</span>
<span class="p">(</span><span class="mi">2000116</span><span class="p">,</span> <span class="s1">'2020-06-12 08:43:56'</span><span class="p">,</span> <span class="s1">'ABC202015'</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">1000000987</span><span class="p">,</span> <span class="s1">'Покупка без акций'</span><span class="p">);</span>

<span class="c1">-- закрытие дельты (фиксация изменений)</span>
<span class="k">COMMIT</span> <span class="n">DELTA</span><span class="p">;</span>
</code></pre></div></div> <h3 id="data_selection"> <a href="#data_selection" class="anchor-heading" aria-labelledby="data_selection"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Выборка данных </h3> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- запрос с неявным указанием столбцов и ключевым словом WHERE</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">sales</span>
<span class="k">WHERE</span> <span class="n">store_id</span> <span class="o">=</span> <span class="mi">1000000123</span><span class="p">;</span>

<span class="c1">-- запрос с агрегацией, группировкой и сортировкой данных, а также выбором первых 5 строк</span>
<span class="k">SELECT</span> <span class="n">s</span><span class="p">.</span><span class="n">store_id</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">product_units</span><span class="p">)</span> <span class="k">AS</span> <span class="n">product_amount</span>
<span class="k">FROM</span> <span class="n">sales</span> <span class="k">AS</span> <span class="n">s</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">store_id</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">product_amount</span> <span class="k">DESC</span>
<span class="k">LIMIT</span> <span class="mi">5</span><span class="p">;</span>

<span class="c1">-- запрос к логическому представлению stores_by_sold_products</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">stores_by_sold_products</span><span class="p">;</span>
</code></pre></div></div> <h3 id="kafka_topic_download"> <a href="#kafka_topic_download" class="anchor-heading" aria-labelledby="kafka_topic_download"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Выгрузка в топик Kafka </h3> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- запуск выгрузки данных из логической таблицы sales</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">sales_ext_download</span> 
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">sales</span> <span class="k">WHERE</span> <span class="n">product_units</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">;</span>
</code></pre></div></div> <h3 id="logical_entities_drop"> <a href="#logical_entities_drop" class="anchor-heading" aria-labelledby="logical_entities_drop"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Удаление логических сущностей </h3> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- удаление внешней таблицы загрузки</span>
<span class="k">DROP</span> <span class="n">UPLOAD</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="n">sales_ext_upload</span><span class="p">;</span>

<span class="c1">-- удаление внешней таблицы выгрузки</span>
<span class="k">DROP</span> <span class="n">DOWNLOAD</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="n">sales_ext_download</span><span class="p">;</span>
</code></pre></div></div> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
