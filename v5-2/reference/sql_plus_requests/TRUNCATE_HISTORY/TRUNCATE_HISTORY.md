---
layout: default
title: TRUNCATE HISTORY
nav_order: 41
parent: Запросы SQL+
grand_parent: Справочная информация
has_children: false
has_toc: false
---

# TRUNCATE HISTORY
{: .no_toc }

<details markdown="block">
  <summary>
    Содержание раздела
  </summary>
  {: .text-delta }
1. TOC
{:toc}
</details>

Запрос позволяет удалить актуальные записи [логической таблицы](../../../overview/main_concepts/logical_table/logical_table.md) 
с историей или только историю изменений. Данные выбираются по условию, указанному в блоке запроса `WHERE`. 
Данные удаляются окончательно и не подлежат восстановлению средствами системы.

Запрос поддерживает два режима работы:
* если в запросе указан момент (метка) времени, удаляется только история — архивные записи таблицы, которые соответствуют условию и 
  стали архивными до последней закрытой на тот момент [дельты](../../../overview/main_concepts/delta/delta.md) (включительно);
* если в запросе указано ключевое слово `infinite`, удаляются записи с историей — архивные и актуальные записи таблицы, 
  которые соответствуют условию.

В ответе возвращается:
*   пустой объект ResultSet при успешном выполнении запроса;
*   исключение при неуспешном выполнении запроса.

Удаление данных с помощью `TRUNCATE HISTORY` не версионируется системой и не записывается в 
[журнал](../../../overview/main_concepts/changelog/changelog.md). Данные, удаленные таким образом, невозможно 
восстановить средствами системы.
{: .warning-wrapper}

На рисунке ниже показан пример удаления истории изменений из таблицы, в которую в течение года было добавлено три версии 
записи по одной торговой точке. Запрос с меткой времени
`'2021-04-10 01:00:00'` удаляет первую версию записи: на тот момент времени последней 
закрытой дельтой была дельта со второй версией записи и только первая версия записи была архивной.

![](truncate_history.svg)
{: .figure-center}
*Удаление истории изменений старше 2021-04-10 01:00:00*
{: .figure-caption-center}

## Синтаксис {#syntax}

```sql
TRUNCATE HISTORY [db_name.]table_name FOR SYSTEM_TIME AS OF date_time_expression
[WHERE filter_expression]
```

Параметры:
*   `db_name` — имя логической базы данных. Опционально, если выбрана логическая БД, 
    [используемая по умолчанию](../../../working_with_system/other_features/default_db_set-up/default_db_set-up.md);
*   `table_name` — имя логической таблицы, данные которой удаляются;
*   `date_time_expression` — выражение, определяющее категорию удаляемых данных. Может принимать 
    следующие значения:
    *   `'YYYY-MM-DD hh:mm:ss'` — удаление истории старше указанного момента времени. Возможные форматы 
        см. в разделе [Форматы даты и времени](../../timestamp_formats/timestamp_formats.md);
    *   `'infinite'` — удаление записей с историей;
*   `filter_expression` — условие выбора удаляемых данных.

## Ограничения {#restrictions}

Выполнение запроса недоступно в сервисной базе данных `INFORMATION_SCHEMA`.

## Пример {#examples}

Удаление истории изменений тех записей, чье значение `product_units` меньше `10`, из таблицы `sales` 
по момент времени `'2019-12-23 15:15:14'`:
```sql
TRUNCATE HISTORY sales.sales FOR SYSTEM_TIME AS OF '2019-12-23 15:15:14'
WHERE product_units < 10
```
Удаление записей, чье значение `id` равно `123456`, с историей изменений из таблицы `stores`:
```sql
TRUNCATE HISTORY sales.stores FOR SYSTEM_TIME AS OF 'infinite'
WHERE id = 123456
```